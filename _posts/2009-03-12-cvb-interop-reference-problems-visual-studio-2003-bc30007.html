---
layout: post
title: C#/VB interop and reference problems in Visual Studio 2003 (BC30007)
tags:
- '2003'
- Bc30007
- C
- Reference
- Vb
- Visual studio
- C#
---

<p>You never end learning something new, I taught I have seen enough when dealing with solutions with C# and VB.NET mixed projects, today working on a legacy system I found the following scenario:</p>  <p>Project A - VB project, defines a set of base classes</p>  <p>Project B - C# project, uses the base classes and defines a set of controls</p>  <p>Project C - VB project, main application module, uses both classes defined in project A and B</p>  <p>All the reference were made to the corresponding projects selecting the projects via the standard Visual Studio add reference dialog box.</p>  <p>When we compiled the solution the compiler kept telling us:</p>  <p><b></b>BC30007: Reference required to assembly ‘Project A’ containing the base class ‘XXX’. Add one to your project.</p>  <p>The funny thing is that the reference is already there; I tried to build a test ‘Project C’ project using C# instead of VB and it all worked well...this seems to me like a bug in the compiler.</p>  <p>Surfing around I wasn’t able to find a lot of info but a single reply to a post that says something like: </p>  <blockquote>   <p>This is a known bug in the VB compiler -- there's a problem whereby the      <br />compiler doesn't recognize that the &quot;Project 1&quot; that &quot;Project 2&quot; refers       <br />to is the same &quot;Project 1&quot; that you've got open in the IDE. The       <br />workaround is to do this: delete the references from Project 3 and       <br />Project 4 to Project 4 and re-add them as file references. That is,       <br />instead of making a reference from the Project tab of the references       <br />dialog, go the .NET tab and Browse for the actual DLL built by Project       <br />1. This should make the error go away and workaround the problem until       <br />there is a fixed compiler.’</p> </blockquote>  <p>And actually I cannot remind the source nor the author, I’m sorry I cannot give the credits for this but I copied and paste the text in a blob document while I was gathering information and I wasn’t able to find it again...but I tried to use the workaround he proposed and it worked.</p>  <p>But making a reference to the file instead to the project you have to be very careful about the compilation order of the assemblies, especially if you change something in the ‘Project A’ assembly.</p>  <p>To completely fix the situation and let Visual Studio to handle the right compilation order for projects you have to follow a series of steps:</p>  <ol>   <li>Go to ‘Project A’ properties and make sure that each configuration build places the final output files in the same directory (this is important cause we make reference to the compiled assembly instead of the project)      <br /><a href="/UserFiles/Guardian/2009/03/csharpvbinterop1.png"><img title="CSharpVBInterop1" style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="205" alt="CSharpVBInterop1" src="/UserFiles/Guardian/2009/03/csharpvbinterop1-thumb.png" width="584" border="0" /></a> </li>    <li>Then we have to look for any reference made to ‘Project A’ inside the solution and change it to a file reference; point the reference to the compiled assembly inside the project bin folder </li>    <li>To let Visual Studio handle the correct order of projects compilation we need to explicitly inform the project that it depends from another project in the solution. So after changing the reference right click on the project and from the context menu select ‘Project dependencies...’      <br /><a href="/UserFiles/Guardian/2009/03/csharpvbinterop2.png"><img title="CSharpVBInterop2" style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="232" alt="CSharpVBInterop2" src="/UserFiles/Guardian/2009/03/csharpvbinterop2-thumb.png" width="368" border="0" /></a>       <br />In this dialog box place a check-mark on your ‘Project A’.       <br />In this way when you recompile the projects or the solution you will always be sure that ‘Project A’ is compiled (or recompiled) before the ones that use it; the right compilation order is respected in the same way as we have used a project reference. </li> </ol>  <p>I don’t know if this problem is present in Visual Studio 2005 and 2008, I didn’t had the chance to test it yet; if someone has more information or suggestions about the whole thing, please write a comment here or contact me directly.</p>  <p></p>  <div class="wlWriterEditableSmartContent" id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:4c36116c-49be-47a5-b99a-8485f1c0277f" style="padding-right: 0px; display: inline; padding-left: 0px; float: none; padding-bottom: 0px; margin: 0px; padding-top: 0px">Technorati Tags: <a href="http://technorati.com/tags/Visual+Studio" rel="tag">Visual Studio</a>,<a href="http://technorati.com/tags/2003" rel="tag">2003</a>,<a href="http://technorati.com/tags/BC30007" rel="tag">BC30007</a>,<a href="http://technorati.com/tags/C%23" rel="tag">C#</a>,<a href="http://technorati.com/tags/VB" rel="tag">VB</a>,<a href="http://technorati.com/tags/reference" rel="tag">reference</a></div><h2>Related Content</h2><ul><li style="list-style-type: none"><a href="http://www.primordialcode.com/blog/post/nunitit-visual-studio-addin-support-nunit-customizations">NUnitit: Visual Studio Addin to support NUnit and some customizations to it</a> (26/08/2015)</li><li style="list-style-type: none"><a href="http://www.primordialcode.com/blog/post/resharper-outofmemoryexception-problem">Resharper and the OutOfMemoryException problem</a> (26/08/2015)</li><li style="list-style-type: none"><a href="http://www.primordialcode.com/blog/post/spot-hidden-exceptions-intellitrace">Spot Hidden Exceptions using IntelliTrace</a> (26/08/2015)</li><li style="list-style-type: none"><a href="http://www.primordialcode.com/blog/post/visual-studio-2010-designer-error-null-parameter-objecttype">Visual Studio 2010 designer error: Value cannot be null. Parameter name: objectType</a> (26/08/2015)</li><li style="list-style-type: none"><a href="http://www.primordialcode.com/blog/post/vs2008-sp1-powercommands-toolbox-additemscrash">VS2008 SP1 + PowerCommands = Toolbox AddItems...Crash!</a> (26/08/2015)</li><li style="list-style-type: none"><a href="/Blog/Related/cvb-interop-reference-problems-visual-studio-2003-bc30007"><strong>More related document (10)</strong></a></li></ul><br />
